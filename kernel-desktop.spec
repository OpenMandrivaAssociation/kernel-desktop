#
# Spec file generated by kdist version v0.0.4-2-gcac9
#
Name:          kernel-desktop
Summary:       The Linux Kernel for Mandriva systems
License:       GPLv2
Version:       2.6.39.4
Release:       %mkrel 2.1
URL:           http://www.kernel.org
Source:        kernel-2.6.39.4-2.1-desktop.tar.bz2
ExclusiveArch: %ix86 x86_64 
BuildRoot:     %{_tmppath}/%{name}-%{PACKAGE_VERSION}-root
AutoReqProv:   no

%global __debug_package 1
%define debug_package %{nil}
%define __check_files %{nil}
%ifarch %ix86 x86_64
%define asmarch x86
%define bzImage arch/x86/boot/bzImage
%endif

Summary:       The Linux Kernel for Mandriva systems
Provides:      kernel = 2.6.39.4.2.1
Provides:      kernel-desktop = 2.6.39.4.2.1
Group:         System/Kernel and hardware

%description
The Linux Kernel, the operating system core itself

%package devel
Summary:       The minimal Linux Kernel for building kernel modules
Provides:      kernel-devel = 2.6.39.4.2.1
Provides:      kernel-desktop-devel = 2.6.39.4.2.1
BuildRequires: rsync

%description -n kernel-desktop-devel
This package provides kernel headers, makefiles and a couple
of others files sufficient to build external kernel modules.

%package debuginfo
Summary:       The debug information for kernel-desktop
Provides:      kernel-debuginfo = 2.6.39.4.2.1
Provides:      kernel-desktop-debuginfo = 2.6.39.4.2.1

%description -n kernel-desktop-debuginfo
This package provides the kernel's debug information required
by some binary object tools like kgdb, perf, etc...

%prep
%setup -q -n 2.6.39.4-2.1-desktop

%build
make defconfig
make -s kernelrelease
test $(make -s kernelrelease) = 2.6.39.4-2.1-desktop
make %{?_smp_mflags}

%install
make -s INSTALL_MOD_PATH=%{buildroot} modules_install
find %{buildroot} -name \*.ko -exec chmod u+x {} \;

mkdir -p %{buildroot}/boot
cp %{bzImage} %{buildroot}/boot/vmlinuz-2.6.39.4-2.1-desktop
cp System.map %{buildroot}/boot/System.map-2.6.39.4-2.1-desktop
cp .config    %{buildroot}/boot/config-2.6.39.4-2.1-desktop
ln -snf /usr/src/devel/2.6.39.4-2.1-desktop %{buildroot}/lib/modules/2.6.39.4-2.1-desktop/build
ln -snf build %{buildroot}/lib/modules/2.6.39.4-2.1-desktop/source

mkdir -p %{buildroot}/usr/src/devel/2.6.39.4-2.1-desktop
cat develfiles-%asmarch.list >>develfiles.list
rsync -ar --files-from=develfiles.list . %{buildroot}/usr/src/devel/2.6.39.4-2.1-desktop

%post -n kernel-desktop
/sbin/installkernel 2.6.39.4-2.1-desktop

%preun -n kernel-desktop
/sbin/installkernel -R 2.6.39.4-2.1-desktop

%postun -n kernel-desktop
/sbin/kernel_remove_initrd 2.6.39.4-2.1-desktop

%clean
rm -rf %{buildroot}

%files -n kernel-desktop
%defattr (-, root, root)
%dir /lib/modules
/lib/modules/2.6.39.4-2.1-desktop
/boot

%files -n kernel-desktop-devel
%defattr (-, root, root)
/usr/src/devel/2.6.39.4-2.1-desktop

%files -n kernel-desktop-debuginfo -f debugfiles.list
%defattr (-, root, root)

%changelog
* Fri Aug 19 2011 Franck Bui <franck.bui@mandriva.com> 2.6.39.4-2.1-desktop
Alex Deucher <alexander.deucher@amd.com> (1):
      drm/radeon/kms: fix regression is handling >2 heads on cedar/caicos

Alex Hacker <hacker@epn.ru> (1):
      ath9k: fix a misprint which leads to incorrect calibration

Bob Copeland <me@bobcopeland.com> (1):
      ath5k: fix error handling in ath5k_beacon_send

Bruce Allan <bruce.w.allan@intel.com> (1):
      e1000e: alternate MAC address does not work on device id 0x1060

Chas Williams <chas@cmf.nrl.navy.mil> (1):
      atm: br2864: sent packets truncated in VC routed mode

Clemens Ladisch <clemens@ladisch.de> (1):
      mm: fix wrong vmap address calculations with odd NR_CPUS values

Daniel Mack <zonque@gmail.com> (1):
      ALSA: snd-usb-caiaq: Correct offset fields of outbound iso_frame_desc

Franck Bui <franck.bui@mandriva.com> (1):
      Mandriva Release v2.6.39.4-2

Ionut Nicu <ionut.nicu@cloudbit.ro> (1):
      USB: ftdi_sio: fix minor typo in get_ftdi_divisor

JiSheng Zhang <jszhang3@gmail.com> (1):
      USB: xhci: fix OS want to own HC

Julia Lawall <julia@diku.dk> (1):
      hwmon: (ibmaem) add missing kfree

Mark Brown <broonie@opensource.wolfsonmicro.com> (1):
      ASoC: Fix binding of WM8750 on Jive

Maxim Nikulin <m.a.nikulin@gmail.com> (1):
      USB: assign instead of equal in usbtmc.c

Nick Bowler <nbowler@elliptictech.com> (1):
      USB: usb-storage: unusual_devs entry for ARM V2M motherboard.

Peter Zijlstra <a.p.zijlstra@chello.nl> (1):
      perf: Fix SIGIO handling

Peter Zijlstra <peterz@infradead.org> (1):
      mm: Fix fixup_user_fault() for MMU=n

Rajkumar Manoharan <rmanohar@qca.qualcomm.com> (2):
      ath9k_hw: Fix incorrect Tx control power in AR9003 template
      ath9k_hw: update PMU to improve ripple issue for AR9485

Rusty Russell <rusty@rustcorp.com.au> (1):
      lguest: allow booting guest with CONFIG_RELOCATABLE=y

Sebastian Andrzej Siewior <bigeasy@linutronix.de> (1):
      usb/config: use proper endian access for wMaxPacketSize

Stefan Lippers-Hollmann <s.L-H@gmx.de> (1):
      staging: rtl8192u: declare MODULE_FIRMWARE

Stephen Warren <swarren@nvidia.com> (1):
      ASoC: Tegra: tegra_pcm_deallocate_dma_buffer: Don't OOPS

Vijay Chavan <vijaychavan007@gmail.com> (1):
      USB: Serial: Added device ID for Qualcomm Modem in Sagemcom's HiLo3G

