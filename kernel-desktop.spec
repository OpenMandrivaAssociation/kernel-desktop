#
# Spec file generated by kdist version v0.0.3-4-g8f81
#
Name:          kernel-desktop
Summary:       The Linux Kernel for Mandriva systems
License:       GPLv2
Version:       2.6.39.1
Release:       %mkrel 1.1
URL:           http://www.kernel.org
Source:        kernel-2.6.39.1-1.1-desktop.tar.bz2
ExclusiveArch: %ix86 x86_64 
BuildRoot:     %{_tmppath}/%{name}-%{PACKAGE_VERSION}-root
AutoReqProv:   no

%global __debug_package 1
%define debug_package %{nil}
%define __check_files %{nil}
%ifarch %ix86 x86_64
%define asmarch x86
%define bzImage arch/x86/boot/bzImage
%endif

Summary:       The Linux Kernel for Mandriva systems
Provides:      %name = 2.6.39.1.1.1.desktop
Group:         System/Kernel and hardware 

%description
The Linux Kernel, the operating system core itself

%package devel
Summary:       The minimal Linux Kernel for building kernel modules
Provides:      kernel-desktop-devel = 2.6.39.1.1.1.desktop
BuildRequires: rsync

%description -n kernel-desktop-devel
This package provides kernel headers, makefiles and a couple
of others files sufficient to build external kernel modules.

%package debuginfo
Summary:       The debug information for kernel-desktop
Provides:      kernel-desktop-debuginfo = 2.6.39.1.1.1.desktop

%description -n kernel-desktop-debuginfo
This package provides the kernel's debug information required
by some binary object tools like kgdb, perf, etc...

%prep
%setup -q -n 2.6.39.1-1.1-desktop

%build
make defconfig
make -s kernelrelease
test $(make -s kernelrelease) = 2.6.39.1-1.1-desktop
make %{?_smp_mflags}

%install

make -s INSTALL_MOD_PATH=%{buildroot} %{_smp_mflags} modules_install
find %{buildroot} -name \*.ko -exec chmod u+x {} \;

mkdir -p %{buildroot}/boot
cp %{bzImage} %{buildroot}/boot/vmlinuz-2.6.39.1-1.1-desktop
cp System.map %{buildroot}/boot/System.map-2.6.39.1-1.1-desktop
cp .config    %{buildroot}/boot/config-2.6.39.1-1.1-desktop
ln -snf /usr/src/devel/2.6.39.1-1.1-desktop %{buildroot}/lib/modules/2.6.39.1-1.1-desktop/build
ln -snf build %{buildroot}/lib/modules/2.6.39.1-1.1-desktop/source

mkdir -p %{buildroot}/usr/src/devel/2.6.39.1-1.1-desktop
cat develfiles-%asmarch.list >>develfiles.list
rsync -ar --files-from=develfiles.list . %{buildroot}/usr/src/devel/2.6.39.1-1.1-desktop

%post -n kernel-desktop
/sbin/installkernel 2.6.39.1-1.1-desktop

%preun -n kernel-desktop
/sbin/installkernel -R 2.6.39.1-1.1-desktop

%postun -n kernel-desktop
/sbin/kernel_remove_initrd 2.6.39.1-1.1-desktop

%clean
rm -rf %{buildroot}

%files -n kernel-desktop
%defattr (-, root, root)
%dir /lib/modules
/lib/modules/2.6.39.1-1.1-desktop
/boot

%files -n kernel-desktop-devel
%defattr (-, root, root)
/usr/src/devel/2.6.39.1-1.1-desktop

%files -n kernel-desktop-debuginfo -f debugfiles.list
%defattr (-, root, root)

